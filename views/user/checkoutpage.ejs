<%- include('../layout/userMeta.ejs') %>

    <style>
        .order-price {
            font-family: 'Roboto', 'Arial', 'Tahoma', 'DejaVu Sans', sans-serif;
        }

        /* category old new new-price*/
        .category {
            font-family: 'Roboto', 'Arial', 'Tahoma', 'DejaVu Sans', sans-serif;
        }

        .old {
            font-family: 'Roboto', 'Arial', 'Tahoma', 'DejaVu Sans', sans-serif;
        }

        .new {
            font-family: 'Roboto', 'Arial', 'Tahoma', 'DejaVu Sans', sans-serif;
        }

        .new-price {
            font-family: 'Roboto', 'Arial', 'Tahoma', 'DejaVu Sans', sans-serif;
        }
    </style>



    <style>
        .panel-title label {
            display: flex;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
        }

        .panel-title input[type="radio"] {
            margin-right: 10px;
            transform: scale(1.2);
        }

        .panel-body {
            margin-left: 30px;
            padding: 10px 0;
        }

        /* The Modal (background) */
        .modal {
            display: none;
            /* Hidden by default */
            position: fixed;
            /* Stay in place */
            z-index: 1;
            /* Sit on top */
            left: 0;
            top: 0;
            width: 100%;
            /* Full width */
            height: 100%;
            /* Full height */
            overflow: auto;
            /* Enable scroll if needed */
            background-color: rgb(0, 0, 0);
            /* Fallback color */
            background-color: rgba(0, 0, 0, 0.4);
            /* Black w/ opacity */
        }

        /* Modal Content/Box */
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            /* Could be more or less, depending on screen size */
        }

        /* The Close Button */
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
    </style>

    </head>

    <body>
        <div class="main-wrapper">
            <%- include('../layout/userHead.ejs') %>
                <!-- offcanvas overlay start -->
                <div class="offcanvas-overlay"></div>
                <!-- offcanvas overlay end -->
                <!-- OffCanvas Wishlist Start -->
                <div id="offcanvas-wishlist" class="offcanvas offcanvas-wishlist">
                    <div class="inner">
                        <div class="head">
                            <span class="title">Wishlist</span>
                            <button class="offcanvas-close">×</button>
                        </div>
                        <div class="body customScroll">
                            <ul class="minicart-product-list">
                                <li>
                                    <a href="single-product.html" class="image"><img
                                            src="assets/images/product-image/1.webp" alt="Cart product Image"></a>
                                    <div class="content">
                                        <a href="single-product.html" class="title">Modern Smart Phone</a>
                                        <span class="quantity-price">1 x <span class="amount">$21.86</span></span>
                                        <a href="#" class="remove">×</a>
                                    </div>
                                </li>
                                <li>
                                    <a href="single-product.html" class="image"><img
                                            src="assets/images/product-image/2.webp" alt="Cart product Image"></a>
                                    <div class="content">
                                        <a href="single-product.html" class="title">Bluetooth Headphone</a>
                                        <span class="quantity-price">1 x <span class="amount">$13.28</span></span>
                                        <a href="#" class="remove">×</a>
                                    </div>
                                </li>
                                <li>
                                    <a href="single-product.html" class="image"><img
                                            src="assets/images/product-image/3.webp" alt="Cart product Image"></a>
                                    <div class="content">
                                        <a href="single-product.html" class="title">Smart Music Box</a>
                                        <span class="quantity-price">1 x <span class="amount">$17.34</span></span>
                                        <a href="#" class="remove">×</a>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="foot">
                            <div class="buttons">
                                <a href="wishlist.html" class="btn btn-dark btn-hover-primary mt-30px">view wishlist</a>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- OffCanvas Wishlist End -->
                <!-- OffCanvas Cart Start -->
                <div id="offcanvas-cart" class="offcanvas offcanvas-cart">
                    <div class="inner">
                        <div class="head">
                            <span class="title">Cart</span>
                            <button class="offcanvas-close">×</button>
                        </div>
                        <div class="body customScroll">
                            <ul class="minicart-product-list">
                                <li>
                                    <a href="single-product.html" class="image"><img
                                            src="assets/images/product-image/1.webp" alt="Cart product Image"></a>
                                    <div class="content">
                                        <a href="single-product.html" class="title">Modern Smart Phone</a>
                                        <span class="quantity-price">1 x <span class="amount">$18.86</span></span>
                                        <a href="#" class="remove">×</a>
                                    </div>
                                </li>
                                <li>
                                    <a href="single-product.html" class="image"><img
                                            src="assets/images/product-image/2.webp" alt="Cart product Image"></a>
                                    <div class="content">
                                        <a href="single-product.html" class="title">Bluetooth Headphone</a>
                                        <span class="quantity-price">1 x <span class="amount">$43.28</span></span>
                                        <a href="#" class="remove">×</a>
                                    </div>
                                </li>
                                <li>
                                    <a href="single-product.html" class="image"><img
                                            src="assets/images/product-image/3.webp" alt="Cart product Image"></a>
                                    <div class="content">
                                        <a href="single-product.html" class="title">Smart Music Box</a>
                                        <span class="quantity-price">1 x <span class="amount">$37.34</span></span>
                                        <a href="#" class="remove">×</a>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="foot">
                            <div class="buttons mt-30px">
                                <a href="cart.html" class="btn btn-dark btn-hover-primary mb-30px">view cart</a>
                                <a href="checkout.html" class="btn btn-outline-dark current-btn">checkout</a>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- OffCanvas Cart End -->
                <!-- OffCanvas Menu Start -->
                <div id="offcanvas-mobile-menu" class="offcanvas offcanvas-mobile-menu">
                    <button class="offcanvas-close"></button>
                    <div class="user-panel">
                        <ul>
                            <li><a href="tel:0123456789"><i class="fa fa-phone"></i> +012 3456 789</a></li>
                            <li><a href="mailto:demo@example.com"><i class="fa fa-envelope-o"></i> demo@example.com</a>
                            </li>
                            <li><a href="my-account.html"><i class="fa fa-user"></i> Account</a></li>
                        </ul>
                    </div>
                    <div class="inner customScroll">
                        <div class="offcanvas-menu mb-4">
                            <ul>
                                <li><a href="#"><span class="menu-text">Home</span></a>
                                    <ul class="sub-menu">
                                        <li><a href="index.html"><span class="menu-text">Home 1</span></a></li>
                                        <li><a href="index-2.html"><span class="menu-text">Home 2</span></a></li>
                                    </ul>
                                </li>
                                <li><a href="about.html">About</a></li>
                                <li>
                                    <a href="#"><span class="menu-text">Pages</span></a>
                                    <ul class="sub-menu">
                                        <li>
                                            <a href="#"><span class="menu-text">Inner Pages</span></a>
                                            <ul class="sub-menu">
                                                <li><a href="404.html">404 Page</a></li>
                                                <li><a href="order-tracking.html">Order Tracking</a></li>
                                                <li><a href="faq.html">Faq Page</a></li>
                                                <li><a href="coming-soon.html">Coming Soon Page</a></li>
                                            </ul>
                                        </li>
                                        <li>
                                            <a href="#"><span class="menu-text"> Other Shop Pages</span></a>
                                            <ul class="sub-menu">
                                                <li><a href="cart.html">Cart Page</a></li>
                                                <li><a href="checkout.html">Checkout Page</a></li>
                                                <li><a href="compare.html">Compare Page</a></li>
                                                <li><a href="wishlist.html">Wishlist Page</a></li>
                                            </ul>
                                        </li>
                                        <li>
                                            <a href="#"><span class="menu-text">Related Shop Page</span></a>
                                            <ul class="sub-menu">
                                                <li><a href="my-account.html">Account Page</a></li>
                                                <li><a href="login.html">Login & Register Page</a></li>
                                                <li><a href="empty-cart.html">Empty Cart Page</a></li>
                                                <li><a href="thank-you-page.html">Thank You Page</a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li><a href="#"><span class="menu-text">Shop</span></a>
                                    <ul class="sub-menu">
                                        <li>
                                            <a href="#"><span class="menu-text">Shop Page</span></a>
                                            <ul class="sub-menu">
                                                <li><a href="shop-3-column.html">Shop 3 Column</a></li>
                                                <li><a href="shop-4-column.html">Shop 4 Column</a></li>
                                                <li><a href="shop-left-sidebar.html">Shop Left Sidebar</a></li>
                                                <li><a href="shop-right-sidebar.html">Shop Right Sidebar</a></li>
                                                <li><a href="shop-list-left-sidebar.html">Shop List Left Sidebar</a>
                                                </li>
                                                <li><a href="shop-list-right-sidebar.html">Shop List Right Sidebar</a>
                                                </li>
                                                <li><a href="cart.html">Cart Page</a></li>
                                                <li><a href="checkout.html">Checkout Page</a></li>
                                            </ul>
                                        </li>
                                        <li>
                                            <a href="#"><span class="menu-text">product Details Page</span></a>
                                            <ul class="sub-menu">
                                                <li><a href="single-product.html">Product Single</a></li>
                                                <li><a href="single-product-variable.html">Product Variable</a></li>
                                                <li><a href="single-product-affiliate.html">Product Affiliate</a></li>
                                                <li><a href="single-product-group.html">Product Group</a></li>
                                                <li><a href="single-product-tabstyle-2.html">Product Tab 2</a></li>
                                                <li><a href="single-product-tabstyle-3.html">Product Tab 3</a></li>
                                                <li><a href="single-product-slider.html">Product Slider</a></li>
                                                <li><a href="single-product-gallery-left.html">Product Gallery Left</a>
                                            </ul>
                                        </li>
                                        <li>
                                            <a href="#"><span class="menu-text">Single Product Page</span></a>
                                            <ul class="sub-menu">
                                                <li><a href="single-product-gallery-right.html">Product Gallery
                                                        Right</a> </li>
                                                <li><a href="single-product-sticky-left.html">Product Sticky Left</a>
                                                </li>
                                                <li><a href="single-product-sticky-right.html">Product Sticky Right</a>
                                                </li>
                                                <li><a href="compare.html">Compare Page</a></li>
                                                <li><a href="wishlist.html">Wishlist Page</a></li>
                                                <li><a href="my-account.html">Account Page</a></li>
                                                <li><a href="login.html">Login & Register Page</a></li>
                                                <li><a href="empty-cart.html">Empty Cart Page</a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li><a href="#"><span class="menu-text">Blog</span></a>
                                    <ul class="sub-menu">
                                        <li><a href="blog-grid.html">Blog Grid Page</a></li>
                                        <li><a href="blog-grid-left-sidebar.html">Grid Left Sidebar</a></li>
                                        <li><a href="blog-grid-right-sidebar.html">Grid Right Sidebar</a></li>
                                        <li><a href="blog-list.html">Blog List Page</a></li>
                                        <li><a href="blog-list-left-sidebar.html">List Left Sidebar</a></li>
                                        <li><a href="blog-list-right-sidebar.html">List Right Sidebar</a></li>
                                        <li><a href="blog-single.html">Blog Single Page</a></li>
                                        <li><a href="blog-single-left-sidebar.html">Single Left Sidebar</a></li>
                                        <li><a href="blog-single-right-sidebar.html">Single Right Sidbar</a>
                                    </ul>
                                </li>
                                <li><a href="contact.html">Contact Us</a></li>
                            </ul>
                        </div>
                        <!-- OffCanvas Menu End -->
                        <div class="offcanvas-social mt-auto">
                            <ul>
                                <li>
                                    <a href="#"><i class="fa fa-facebook"></i></a>
                                </li>
                                <li>
                                    <a href="#"><i class="fa fa-twitter"></i></a>
                                </li>
                                <li>
                                    <a href="#"><i class="fa fa-google"></i></a>
                                </li>
                                <li>
                                    <a href="#"><i class="fa fa-youtube"></i></a>
                                </li>
                                <li>
                                    <a href="#"><i class="fa fa-instagram"></i></a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- OffCanvas Menu End -->
                <!-- breadcrumb-area start -->
                <div class="breadcrumb-area">
                    <div class="container">
                        <div class="row align-items-center justify-content-center">
                            <div class="col-12 text-center">
                                <h2 class="breadcrumb-title">Checkout</h2>
                                <!-- breadcrumb-list start -->
                                <!-- <ul class="breadcrumb-list">
                            <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                            <li class="breadcrumb-item active">Checkout</li>
                        </ul> -->
                                <!-- breadcrumb-list end -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- breadcrumb-area end -->
                <!-- checkout area start -->
                <div class="checkout-area pt-100px pb-100px">
                    <div class="container">
                        <div class="row">


                            <div class="col-lg-4">
                                <div class="billing-info-wrap">
                                    <h3>Billing Details</h3>

                                    <div class="mt-1">
                                        <% if (typeof addresses !='undefined' && addresses.length> 0) { %>
                                            <ul class="list-group">
                                                <% addresses.forEach((add, index)=> { %>
                                                    <li
                                                        class="list-group-item position-relative d-flex align-items-start">
                                                        <!-- Radio Button -->
                                                        <input class="w-auto h-auto me-3" type="radio"
                                                            name="addressSelection" id="address<%= index %>"
                                                            value="<%= add.id %>" <%=index===0 ? 'checked' : '' %>>
                                                        <input type="hidden" value="<%= add.id %>">


                                                        <div class="flex-grow-1 ms-4">
                                                            <address class="mb-0">
                                                                <span><strong>Name:</strong>
                                                                    <%= add.name%>
                                                                </span><br>
                                                                <span><strong>Phone:</strong>
                                                                    <%= add.phone %>
                                                                </span><br>
                                                                <span><strong>Street:</strong>
                                                                    <%= add.street %>
                                                                </span><br>
                                                                <span><strong>City:</strong>
                                                                    <%= add.city %>
                                                                </span><br>
                                                                <span><strong>State:</strong>
                                                                    <%= add.state %>
                                                                </span><br>
                                                                <span><strong>ZIP:</strong>
                                                                    <%= add.zip %>
                                                                </span><br>
                                                                <span><strong>Country:</strong>
                                                                    <%= add.country %>
                                                                </span>
                                                            </address>
                                                        </div>

                                                        <!-- Cross Remove Button
                                                        <button class="btn-close position-absolute top-0 end-0 m-2 remove-address"
                                                                aria-label="Close"
                                                                onclick="removeAddress(event, '<%= index %>')"></button> -->
                                                    </li>
                                                    <% }) %>
                                            </ul>
                                            <% } %>
                                    </div>


                                    <div class="checkout-account mt-25">
                                        <input class="checkout-toggle w-auto h-auto" type="checkbox" />
                                        <label>Ship to a different address?</label>
                                    </div>
                                    <div class="different-address open-toggle mt-30px">
                                        <div class="row">
                                            <!-- <div class="col-lg-6 col-md-6">
                                                <div class="billing-info mb-4">
                                                    <label>First Name</label>
                                                    <input type="text" />
                                                </div>
                                            </div>
                                            <div class="col-lg-6 col-md-6">
                                                <div class="billing-info mb-4">
                                                    <label>Last Name</label>
                                                    <input type="text" />
                                                </div>
                                            </div> -->
                                            <!-- <div class="col-lg-12">
                                                <div class="billing-info mb-4">
                                                    <label>Company Name</label>
                                                    <input type="text" />
                                                </div>
                                            </div> -->
                                            <div class="col-lg-12">
                                                <div class="billing-info mb-4">
                                                    <label>Name</label>
                                                    <input class="billing-address" placeholder="name" type="text"
                                                        id="name" />
                                                    <!-- <input placeholder="Apartment, suite, unit etc." type="text" /> -->
                                                </div>
                                            </div>
                                            <div class="col-lg-12">
                                                <div class="billing-info mb-4">
                                                    <label>Phone</label>
                                                    <input class="billing-address" placeholder="phone" type="text"
                                                        id="phone" />
                                                    <!-- <input placeholder="Apartment, suite, unit etc." type="text" /> -->
                                                </div>
                                            </div>
                                            <div class="col-lg-12">
                                                <div class="billing-select mb-4">
                                                    <div class="billing-info mb-4">
                                                        <label>Street</label>
                                                        <input type="text" id="street" />
                                                    </div>
                                                    <!-- <select>
                                                        <option>Select a country</option>
                                                        <option>Azerbaijan</option>
                                                        <option>Bahamas</option>
                                                        <option>Bahrain</option>
                                                        <option>Bangladesh</option>
                                                        <option>Barbados</option>
                                                    </select> -->
                                                </div>
                                            </div>
                                            <div class="col-lg-12">
                                                <div class="billing-info mb-4">
                                                    <label>City</label>
                                                    <input class="billing-address" placeholder="city" type="text"
                                                        id="city" />
                                                    <!-- <input placeholder="Apartment, suite, unit etc." type="text" /> -->
                                                </div>
                                            </div>
                                            <div class="col-lg-12">
                                                <div class="billing-info mb-4">
                                                    <label>State</label>
                                                    <input type="text" id="state" />
                                                </div>
                                            </div>

                                            <div class="col-lg-6 col-md-6">
                                                <div class="billing-info mb-4">
                                                    <label>Postcode / ZIP</label>
                                                    <input type="text" id="zip" />
                                                </div>
                                            </div>
                                            <div class="col-lg-6 col-md-6">
                                                <div class="billing-info mb-4">
                                                    <label>Country</label>
                                                    <input type="text" id="country" />
                                                </div>
                                            </div>
                                            <!-- <div class="col-lg-6 col-md-6">
                                                <div class="billing-info mb-4">
                                                    <label>Phone</label>
                                                    <input type="text" />
                                                </div>
                                            </div>
                                            <div class="col-lg-6 col-md-6">
                                                <div class="billing-info mb-4">
                                                    <label>Email Address</label>
                                                    <input type="text" />
                                                </div>
                                            </div> -->
                                            <div class="save_button mt-3">
                                                <button class="btn" onclick="addAddressFromCheckout(event)">Add</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-3"></div>

                            <div class="col-lg-5 m-0 p-0 ">
                                <div class="your-order-area">
                                    <div class="discount-code-wrapper mb-4 p-4">
                                        <div class="title-wrap">
                                            <h4 class="cart-bottom-title section-bg-gray">Use Coupon Code</h4>
                                        </div>
                                        <div class="discount-code">
                                            <p class="mb-0"><a id="openModal" class="text-primary">Available Coupons</a>
                                            </p>
                                            <div class="text-success" id="coupon-success"></div>


                                            <div id="couponModal" class="modal">
                                                <div class="modal-content">
                                                    <span class="close">&times;</span>
                                                    <h2>Coupon Details</h2>
                                                    <% if(typeof coupons !='undefined' ){ %>

                                                        <p>Here are some great coupons for you:</p>
                                                        <hr>
                                                        <% coupons.forEach(val=> { %>
                                                            <ul>
                                                                <li>Coupon name: <%= val.name %>
                                                                </li>
                                                                <li>Code: <a id="couponCode<%= val.id %>">
                                                                        <%= val.code %>
                                                                    </a>
                                                                </li>
                                                                <li>discount: <%= val.discountAmount %>
                                                                </li>
                                                                <li>end Date: <%=
                                                                        val.endDate.toLocaleDateString('en-GB') %>
                                                                </li>
                                                                <li>Min Purchase Amount: <%= val.minPurchaseAmount %>
                                                                </li>
                                                                <a onclick="copyCode(event, '<%= val.id %>')" href>Copy
                                                                    Code</a>
                                                            </ul>
                                                            <hr>
                                                            <% }) %>
                                                                <% } %>
                                                </div>
                                            </div>

                                            <form class="d-flex flex-column">
                                                <input type="text" required="" id="coupon-code" class="mb-2" />
                                                <div class="d-flex justify-content-between">
                                                    <button class="cart-btn-2 btn btn-primary"
                                                        onclick="applycoupon(event)" type="button">Apply Coupon</button>
                                                    <button onclick="reload(event)"
                                                        class="cart-btn-2 bg-secondary btn btn-secondary"
                                                        type="button">Cancel</button>
                                                </div>
                                            </form>

                                        </div>
                                    </div>
                                    <h3>Your order</h3>
                                    <div class="your-order-wrap gray-bg-4">
                                        <div class="your-order-product-info">
                                            <div class="your-order-top">
                                                <ul>
                                                    <li>Product</li>
                                                    <li>Total</li>
                                                </ul>
                                            </div>
                                            <div class="your-order-middle">
                                                <ul>
                                                    <% if(typeof userCartItems !='undefined' ) { %>
                                                        <% userCartItems.forEach(item=> { %>
                                                            <li>
                                                                <span class="order-middle-left">
                                                                    <%= item.productId.productName %> X <%=
                                                                            item.quantity %>
                                                                </span>
                                                                <span class="order-price">
                                                                    <% if(item.productId.offerPrice> 0) {%>
                                                                        ₹<%= (item.productId.offerPrice *
                                                                            item.quantity)%>
                                                                            <% }else{ %>
                                                                                ₹<%= (item.productId.price *
                                                                                    item.quantity) %>
                                                                                    <% } %>
                                                                </span>
                                                            </li>
                                                            <% }) %>
                                                                <% } %>
                                                </ul>
                                            </div>
                                            <div class="your-order-bottom">
                                                <!-- <ul class="mb-2">
                                                    <li class="your-order-shipping">Shipping</li>
                                                    <li class="new">₹40</li>
                                                </ul> -->
                                                <ul hidden id="discount-div">
                                                    <li class="your-order-shipping">Discount</li>
                                                    <li class="new" id="discount-price-div">₹</li>
                                                </ul>
                                            </div>
                                            <div class="your-order-total">
                                                <ul>
                                                    <li class="order-total">Total</li>
                                                    <li id="ordertotal"
                                                        style="font-family: 'Roboto', 'Arial', 'Tahoma', 'DejaVu Sans', sans-serif;">
                                                        ₹0.00</li>
                                                    <!-- This will be updated by JavaScript -->
                                                </ul>
                                            </div>
                                        </div>
                                        <form>
                                            <div class="payment-method">
                                                <div class="payment-accordion element-mrg">
                                                    <div id="faq" class="panel-group">
                                                        <div class="panel panel-default single-my-account m-0">
                                                            <div class="panel-heading my-account-title">
                                                                <h4 class="panel-title">
                                                                    <label style="font-weight: normal;">
                                                                        <input type="radio" name="payment-method"
                                                                            value="razorPay" style="width: 15px;"
                                                                            checked>
                                                                        Razor pay
                                                                    </label>
                                                                </h4>
                                                            </div>
                                                        </div>

                                                        <div class="panel panel-default single-my-account m-0">
                                                            <div class="panel-heading my-account-title">
                                                                <h4 class="panel-title">
                                                                    <label style="font-weight: normal;">
                                                                        <input type="radio" name="payment-method"
                                                                            value="Wallet" style="width: 15px;">
                                                                        Wallet
                                                                    </label>
                                                                </h4>
                                                            </div>
                                                        </div>

                                                        <div class="panel panel-default single-my-account m-0">
                                                            <div class="panel-heading my-account-title">
                                                                <h4 class="panel-title">
                                                                    <label style="font-weight: normal;" id="cod">
                                                                        <input type="radio" name="payment-method"
                                                                            value="cashOnDelivery" style="width: 15px;">
                                                                        Cash on delivery
                                                                    </label>
                                                                    <p id="cod-error"
                                                                        style="display: none; color: black;">*Orders
                                                                        above Rs 2000 are not eligible for Cash on
                                                                        Delivery.</p>

                                                                </h4>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="Place-order mt-25">
                                        <a class="btn-hover" onclick="placeOrder(event)">Place Order</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- checkout area end -->
                <!-- Footer Area Start -->
                <%- include('../layout/userFooter.ejs') %>

                <!-- Footer Area End -->
        </div>
        <!-- Global Vendor, plugins JS -->
        <!-- JS Files
    ============================================ -->
        <script src="assets/js/vendor/bootstrap.bundle.min.js"></script>
        <script src="assets/js/vendor/jquery-3.6.0.min.js"></script>
        <script src="assets/js/vendor/jquery-migrate-3.3.2.min.js"></script>
        <script src="assets/js/vendor/modernizr-3.11.2.min.js"></script>
        <script src="assets/js/plugins/jquery.countdown.min.js"></script>
        <script src="assets/js/plugins/swiper-bundle.min.js"></script>
        <script src="assets/js/plugins/scrollUp.js"></script>
        <script src="assets/js/plugins/venobox.min.js"></script>
        <script src="assets/js/plugins/jquery-ui.min.js"></script>
        <script src="assets/js/plugins/mailchimp-ajax.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
        <script src="https://checkout.razorpay.com/v1/checkout.js"></script>




        <!-- Minify Version -->
        <!-- <script src="assets/js/vendor.min.js"></script>
    <script src="assets/js/plugins.min.js"></script>
    <script src="assets/js/main.min.js"></script> -->

        <!--Main JS (Common Activation Codes)-->
        <script src="assets/js/main.js"></script>
        <!-- coupon modal -->
        <script>
            // Get the modal
            var modal = document.getElementById("couponModal");

            // Get the button that opens the modal
            var btn = document.getElementById("openModal");

            // Get the <span> element that closes the modal
            var span = document.getElementsByClassName("close")[0];

            // When the user clicks the button, open the modal 
            btn.onclick = function () {
                modal.style.display = "block";
            }

            // When the user clicks on <span> (x), close the modal
            span.onclick = function () {
                modal.style.display = "none";
            }

            // When the user clicks anywhere outside of the modal, close it
            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }

        </script>

        <!-- checkout total -->
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                axios.post('/checkoutTotal')
                    .then(res => {
                        const productsDetails = res.data.productsDetails;
                        let total = 0;

                        productsDetails.forEach(item => {
                            total += item.effectivePrice * item.quantity;
                        });

                        if (total > 2000) {
                            let codError = document.getElementById('cod-error')
                            codError.style.display = 'block'

                            let cod = document.getElementById('cod')
                            cod.style.display = 'none'
                        }

                        const totalDiv = document.getElementById('ordertotal');
                        totalDiv.innerHTML = `₹${total.toFixed(2)}`;
                    })
                    .catch(err => {
                        console.log(err);
                    });

            })
        </script>

        <!-- add address -->
        <script>
            function addAddressFromCheckout(event) {
                event.preventDefault()


                const name = document.getElementById('name').value;
                const phone = document.getElementById('phone').value;
                const street = document.getElementById('street').value;
                const city = document.getElementById('city').value;
                const state = document.getElementById('state').value;
                const zip = document.getElementById('zip').value;
                const country = document.getElementById('country').value;

                // Display a message or handle the new address
                // alert(`Address Saved: ${street}, ${city}, ${state}, ${zip}, ${country}`);

                const addressData = {
                    name: name,
                    phone: phone,
                    street: street,
                    city: city,
                    state: state,
                    zip: zip,
                    country: country
                }

                axios.post('/addressadd', addressData)
                    .then(res => {
                        if (res.data.status === 7) {
                            Swal.fire({
                                icon: "success",
                                title: "address added",
                                text: "",
                                // showDenyButton: true,
                                // showCancelButton: true,
                                confirmButtonColor: '#0056b3',
                                confirmButtonText: "Ok",
                                // denyButtonText: `Don't save`
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    window.location.reload()
                                }
                            })
                        }
                    })
                    .catch(err => {
                        console.log(err)
                    })
            }
        </script>

        <!-- place order -->
        <script>
            function placeOrder(event) {
                event.preventDefault()

                const paymentMethod = document.querySelector('input[name="payment-method"]:checked').value
                const succesMsg = document.getElementById('coupon-success')

                let couponApplied = ''

                if (succesMsg.innerText == '*coupon applied') {
                    const coupon = document.getElementById('coupon-code').value

                    couponApplied = coupon
                }


                if (paymentMethod == 'cashOnDelivery') {

                    let checkedAddress = document.querySelector('input[name="addressSelection"]:checked');

                    if (!checkedAddress) {
                        return Swal.fire({
                            icon: "error",
                            title: "Address!",
                            text: "please select or create a new address",
                            showCancelButton: true,
                            showConfirmButton: false,
                            cancelButtonText: "OK",
                        }).then((result) => {
                            // if (result.dismiss === Swal.DismissReason.cancel) {
                            //     otpInputs.forEach(input => input.value = '');
                            //     otpInputs[0].focus();
                            // }
                        });
                    }

                    let address = checkedAddress.value

                    axios.post('/placeOrder', { address: address, coupon: couponApplied })
                        .then(res => {

                            console.log(res.data.orderId)
                            if (res.data.error == 1) {
                                Swal.fire({
                                    icon: "error",
                                    title: "quantity!",
                                    text: "products don't have enough quantity",
                                    showCancelButton: true,
                                    showConfirmButton: false,
                                    cancelButtonText: "OK",
                                }).then((result) => {
                                    // if (result.dismiss === Swal.DismissReason.cancel) {
                                    //     otpInputs.forEach(input => input.value = '');
                                    //     otpInputs[0].focus();
                                    // }
                                });
                            } else if (res.data.success == 7) {
                                Swal.fire({
                                    icon: "success",
                                    title: "Order Placed!",
                                    text: "Your order was placed successfully.",
                                    showConfirmButton: true,
                                    confirmButtonText: "View details",
                                    confirmButtonColor: '#266bf9'
                                }).then((result) => {
                                    if (result.isConfirmed) {
                                        window.location.href = `/orderDetails/?orderId=${res.data.orderId}`;
                                    }
                                });

                            }
                        })
                        .catch(err => {
                            console.log(err)
                        })

                } else if (paymentMethod == 'razorPay') {

                    let checkedAddress = document.querySelector('input[name="addressSelection"]:checked');

                    if (!checkedAddress) {
                        return Swal.fire({
                            icon: "error",
                            title: "Address!",
                            text: "please select or create a new address",
                            showCancelButton: true,
                            showConfirmButton: false,
                            cancelButtonText: "OK",
                        }).then((result) => {
                            // if (result.dismiss === Swal.DismissReason.cancel) {
                            //     otpInputs.forEach(input => input.value = '');
                            //     otpInputs[0].focus();
                            // }
                        });
                    }

                    let address = checkedAddress.value

                    axios.post('/razorPay', { address: address, coupon: couponApplied })
                        .then(res => {
                            console.log(res.data);
                            if (res.data.error == 1) {
                                Swal.fire({
                                    icon: "error",
                                    text: "Some products don't have enough quantity.",
                                    showCancelButton: true,
                                    showConfirmButton: false,
                                    cancelButtonText: "OK",
                                });
                            } else {
                                razorpayPayment(res.data.order, res.data.orderId);
                            }
                        })
                        .catch(err => {
                            console.log(err);
                        });

                    function razorpayPayment(order, orderId) {
                        const options = {
                            key: "rzp_test_i8191KFpq7S1w1",
                            amount: order.amount * 100,
                            currency: order.currency,
                            name: 'Gadget Galaxy',
                            description: 'Purchase Description',
                            order_id: order.id,
                            handler: function (response) {
                                // Verify payment on the server
                                axios.post('/verifyPayment', {
                                    id: orderId,
                                    paymentId: response.razorpay_payment_id,
                                    orderId: response.razorpay_order_id,
                                    signature: response.razorpay_signature,
                                    address: address,
                                    coupon: couponApplied
                                })
                                    .then(verifyRes => {
                                        if (verifyRes.data.success) {
                                            Swal.fire({
                                                icon: "success",
                                                title: "Order Placed!",
                                                text: "Your order was placed successfully.",
                                                confirmButtonText: "View details",
                                                confirmButtonColor: '#266bf9'
                                            }).then((result) => {
                                                if (result.isConfirmed) {
                                                    window.location.href = `/orderDetails/?orderId=${verifyRes.data.orderId}`;
                                                }
                                            });
                                        } else {
                                            Swal.fire({
                                                icon: "error",
                                                title: "Verification Failed!",
                                                text: "There was an issue verifying your payment. Please contact support.",
                                                confirmButtonText: "OK",
                                                confirmButtonColor: '#d33'
                                            });
                                        }
                                    })
                                    .catch(err => {
                                        console.log(err);
                                        Swal.fire({
                                            icon: "error",
                                            title: "Server Error!",
                                            text: "Unable to verify payment. Please try again later.",
                                            confirmButtonText: "OK",
                                            confirmButtonColor: '#d33'
                                        });
                                    });
                            },
                            modal: {
                                ondismiss: function ondismiss() {

                                    // Redirect the user to the order details page
                                    Swal.fire({
                                        icon: "warning",
                                        title: "Payment Incomplete!",
                                        text: "Your payment was not completed. You can continue your payment from the order details page.",
                                        confirmButtonText: "Go to Orders",
                                        confirmButtonColor: '#266bf9'
                                    }).then((result) => {
                                        if (result.isConfirmed) {
                                            window.location.href = `/orderDetails/?orderId=${orderId}`;
                                        }
                                    });
                                }
                            },
                            // Other options...
                        };
                        const rzp1 = new Razorpay(options);
                        rzp1.open();
                    }



                } else if (paymentMethod == 'Wallet') {
                    let checkedAddress = document.querySelector('input[name="addressSelection"]:checked');

                    if (!checkedAddress) {
                        return Swal.fire({
                            icon: "error",
                            title: "Address!",
                            text: "please select or create a new address",
                            showCancelButton: true,
                            showConfirmButton: false,
                            cancelButtonText: "OK",
                        }).then((result) => {
                            // if (result.dismiss === Swal.DismissReason.cancel) {
                            //     otpInputs.forEach(input => input.value = '');
                            //     otpInputs[0].focus();
                            // }
                        });
                    }

                    let address = checkedAddress.value

                    axios.post('/placeOrderWithWallet', { address: address, coupon: couponApplied })
                        .then(res => {
                            if (res.data.error == 1) {
                                Swal.fire({
                                    icon: "error",
                                    title: "quantity!",
                                    text: "products don't have enough quantity",
                                    showCancelButton: true,
                                    showConfirmButton: false,
                                    cancelButtonText: "OK",
                                }).then((result) => {
                                    // if (result.dismiss === Swal.DismissReason.cancel) {
                                    //     otpInputs.forEach(input => input.value = '');
                                    //     otpInputs[0].focus();
                                    // }
                                });
                            } else if (res.data.success == 7) {
                                Swal.fire({
                                    icon: "success",
                                    title: "Order Placed!",
                                    text: "Your order was placed successfully.",
                                    showConfirmButton: true,
                                    confirmButtonText: "View details",
                                    confirmButtonColor: '#266bf9'
                                }).then((result) => {
                                    if (result.isConfirmed) {
                                        window.location.href = `/orderDetails/?orderId=${res.data.orderId}`;
                                    }
                                });

                            } else if (res.data.error) {
                                Swal.fire({
                                    icon: "error",
                                    title: "Insufficient Balance!",
                                    text: "Oops! Your balance is too low for this transaction.",
                                    showCancelButton: true,
                                    showConfirmButton: false,
                                    cancelButtonText: "OK",
                                }).then((result) => {
                                    // if (result.dismiss === Swal.DismissReason.cancel) {
                                    //     otpInputs.forEach(input => input.value = '');
                                    //     otpInputs[0].focus();
                                    // }
                                });
                            }
                        })
                        .catch(err => {
                            console.log(err)
                        })
                }


            }
        </script>

        <!-- apply coupon -->
        <script>
            function applycoupon(event) {
                event.preventDefault()

                const couponInput = document.getElementById('coupon-code').value

                axios.post('/applyCoupon', { couponCode: couponInput })
                    .then(res => {
                        const succesMsg = document.getElementById('coupon-success')

                        console.log(res.data)

                        if (res.data.discountedAmount) {
                            const totalDiv = document.getElementById('ordertotal')
                            const discoundDiv = document.getElementById('discount-div')
                            const discountPriceDiv = document.getElementById('discount-price-div')

                            discoundDiv.removeAttribute('hidden')
                            discountPriceDiv.innerHTML = `₹${res.data.discount}`

                            totalDiv.innerHTML = res.data.discountedAmount
                            succesMsg.classList.remove('text-danger')
                            succesMsg.classList.add('text-success')
                            succesMsg.innerText = '*coupon applied'
                        } else if (res.data.error) {
                            succesMsg.classList.remove('text-success')
                            succesMsg.classList.add('text-danger')
                            succesMsg.innerText = res.data.error
                        } else {
                            succesMsg.innerText = ''
                        }
                    })
                    .catch(err => {
                        console.log(err)
                    })
            }
        </script>

        <!-- copy coupon code -->
        <script>
            function copyCode(event, couponId) {
                event.preventDefault()

                const couponCode = document.getElementById(`couponCode${couponId}`).innerText
                let input = document.getElementById('coupon-code')

                let tempInput = document.createElement('input')
                tempInput.value = couponCode
                document.body.appendChild(tempInput)

                tempInput.select()
                document.execCommand('copy')

                input.value = couponCode

                document.body.removeChild(tempInput)
            }
        </script>

        <script>
            function reload(event) {
                event.preventDefault()

                window.location.reload()
            }
        </script>

    </body>


    <!-- Mirrored from htmldemo.net/hmart/hmart/checkout.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 02 May 2024 11:06:53 GMT -->

    </html>